{% extends "base.html" %}

{% block title %}Inicio - To Do List{% endblock %}

{% block content %}

<!-- 🔝 FORMULARIO ARRIBA DE TODO -->
<div class="container mt-4">
  <form action="/agregar" method="POST" class="p-3 rounded shadow-sm bg-dark bg-opacity-25 border-0">
    <div class="row g-2 align-items-center">
      <!-- Descripción -->
      <div class="col-md-5">
        <input type="text" name="descripcion" id="entry" class="form-control" placeholder="Nueva tarea..." required>
      </div>
      <!-- Impacto -->
      <div class="col-md-2">
        <select name="impacto" id="entry" class="form-select">
          <option value="" disabled selected>Impacto</option>
          <option value="Bajo">Bajo</option>
          <option value="Medio">Medio</option>
          <option value="Alto">Alto</option>
        </select>
      </div>
      <!-- Fecha -->
      <div class="col-md-3">
        <input type="date" name="fecha" id="entry" class="form-control">
      </div>
      <!-- Botón -->
      <div class="col-md-2 text-end">
        <button class="btn btn-primary fw-bold w-100" type="submit">+</button>
      </div>
    </div>
  </form>
</div>

<!-- ⚙️ CONTENIDO PRINCIPAL: dos columnas -->
<div class="container">
  <div class="row">
    <!-- 📋 Columna izquierda: tareas -->
    <div class="col-md-8">
      <!-- Mensajes -->
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="alert alert-info p-2 m-2 small">
            {% for mensaje in messages %}
              <p class="m-0">{{ mensaje }}</p>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- 🕒 Pendientes -->
      <div class="card bg-dark bg-opacity-25 shadow-sm mb-4 border-0">
        <div class="card-header bg-primary bg-gradient text-white fw-bold">
          🕒 Pendientes
        </div>
        <ul class="list-group list-group-flush">
          {% for tarea in tareas if tarea.estado == 'Por hacer' %}
          <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent text-white">
            <div>
              <span class="fw-semibold">{{ tarea.descripcion }}</span>
              {% if tarea.fecha %}
              <small class="text-white-50 ms-2">{{ tarea.fecha }}</small>
              {% endif %}
              {% if tarea.impacto %}
              <span class="badge 
                {% if tarea.impacto == 'Alto' %} bg-danger 
                {% elif tarea.impacto == 'Medio' %} bg-warning text-dark 
                {% else %} bg-info text-dark {% endif %} 
                ms-2">{{ tarea.impacto }}</span>
              {% endif %}
            </div>
            <div class="d-flex gap-2">
              <form action="/completar/{{ tarea.descripcion }}" method="POST">
                <button type="submit" class="btn btn-outline-success btn-sm">✔</button>
              </form>
              <form action="/eliminar/{{ tarea.descripcion }}" method="POST">
                <button type="submit" class="btn btn-outline-danger btn-sm">✖</button>
              </form>
            </div>
          </li>
          {% else %}
          <li class="list-group-item bg-transparent text-white-50 text-center">
            No hay tareas pendientes 🎉
          </li>
          {% endfor %}
        </ul>
      </div>

      <!-- ✅ Completadas -->
      <div class="card bg-dark bg-opacity-25 shadow-sm mb-4 border-0">
        <div class="card-header bg-success bg-gradient text-white fw-bold">
          ✅ Completadas
        </div>
        <ul class="list-group list-group-flush">
          {% for tarea in tareas if tarea.estado == 'Completado' %}
          <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent text-white-50 text-decoration-line-through">
            <div>
              <span>{{ tarea.descripcion }}</span>
              {% if tarea.fecha %}
              <small class="text-white-50 ms-2">{{ tarea.fecha }}</small>
              {% endif %}
              {% if tarea.impacto %}
              <span class="badge bg-secondary m-2">{{ tarea.impacto }}</span>
              {% endif %}
            </div>
            <form action="/eliminar/{{ tarea.descripcion }}" method="POST">
              <button type="submit" class="btn btn-outline-danger btn-sm">✖</button>
            </form>
          </li>
          {% else %}
          <li class="list-group-item bg-transparent text-white-50 text-center">
            No hay tareas completadas todavía.
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <!-- 🧠 Columna derecha: Prioridades + Notas -->
    <div class="col-md-4">
      <!-- ⚡ Prioridades -->
      <div class="card bg-dark bg-opacity-25 shadow-sm mb-4 border-0">
        <div class="card-header bg-warning bg-gradient text-dark fw-bold">
          ⚡ Prioridades
        </div>
        <div class="card-body">
          <textarea class="form-control bg-transparent text-white border-0" rows="4" placeholder="Escribe tus prioridades aquí..."></textarea>
        </div>
      </div>

      <!-- 📝 Notas / Recordatorios -->
      <div class="card bg-dark bg-opacity-25 shadow-sm border-0">
        <div class="card-header bg-info bg-gradient text-dark fw-bold">
          📝 Notas / Recordatorios
        </div>
        <div class="card-body">
          <textarea class="form-control bg-transparent text-white border-0" rows="4" placeholder="Anota ideas, pendientes personales o recordatorios..."></textarea>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

